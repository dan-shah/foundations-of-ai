<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Interactive Calculus Visualizations</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    padding: 0;
    background: #0d0d1a;
    color: #e0e0e0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    font-size: 15px;
    line-height: 1.6;
  }

  /* Header */
  header {
    max-width: 780px;
    margin: 0 auto;
    padding: 60px 24px 40px;
    text-align: center;
  }
  header h1 {
    font-size: 36px;
    color: #e94560;
    margin: 0 0 12px;
    font-weight: 700;
  }
  header p {
    color: #a0a0b0;
    font-size: 16px;
    max-width: 600px;
    margin: 0 auto;
  }

  /* Navigation */
  nav {
    max-width: 780px;
    margin: 0 auto 40px;
    padding: 0 24px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }
  nav a {
    background: #16213e;
    color: #16c79a;
    text-decoration: none;
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 13px;
    border: 1px solid #3a3a5c;
    transition: background 0.2s;
  }
  nav a:hover {
    background: #1a3a5e;
  }

  /* Sections */
  .viz-section {
    max-width: 780px;
    margin: 0 auto 80px;
    padding: 0 24px;
  }
  .viz-section h2 {
    color: #e94560;
    font-size: 26px;
    border-bottom: 1px solid #3a3a5c;
    padding-bottom: 10px;
    margin: 0 0 16px;
  }
  .viz-section .intro {
    color: #c0c0d0;
    margin: 0 0 20px;
  }

  /* Try This */
  .try-this {
    background: #16213e;
    border-left: 3px solid #e94560;
    padding: 14px 18px;
    margin: 20px 0 16px;
    border-radius: 0 6px 6px 0;
  }
  .try-this strong { color: #e94560; display: block; margin-bottom: 6px; }
  .try-this ol { margin: 0; padding-left: 20px; }
  .try-this li { margin-bottom: 6px; color: #c0c0d0; }

  /* Formal Definition */
  .formal-def {
    background: #16213e;
    border-left: 3px solid #16c79a;
    padding: 14px 18px;
    margin: 0 0 20px;
    border-radius: 0 6px 6px 0;
  }
  .formal-def h3 {
    color: #16c79a;
    margin: 0 0 8px;
    font-size: 15px;
  }
  .formal-def p { margin: 4px 0; color: #c0c0d0; }
  .formal-def code {
    background: #1a1a2e;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 13px;
  }

  /* Summary table */
  .summary-section {
    max-width: 780px;
    margin: 0 auto 60px;
    padding: 0 24px;
  }
  .summary-section h2 {
    color: #e94560;
    font-size: 24px;
    border-bottom: 1px solid #3a3a5c;
    padding-bottom: 8px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
  }
  th {
    background: #16213e;
    color: #16c79a;
    text-align: left;
    padding: 10px 12px;
    font-size: 13px;
    border-bottom: 2px solid #3a3a5c;
  }
  td {
    padding: 10px 12px;
    border-bottom: 1px solid #2a2a4a;
    font-size: 14px;
  }

  /* Divider between sections */
  .section-divider {
    max-width: 780px;
    margin: 0 auto;
    border: none;
    border-top: 1px solid #2a2a4a;
    margin-bottom: 60px;
  }
</style>
</head>
<body>

<header>
  <h1>Interactive Calculus Visualizations</h1>
  <p>Explore calculus concepts by dragging points, adjusting sliders, and toggling overlays. Each visualization is interactive &mdash; manipulate the controls to discover key insights.</p>
</header>

<nav>
  <a href="#viz-tangent">1. Tangent Lines</a>
  <a href="#viz-comparator">2. Derivative Comparator</a>
  <a href="#viz-chain">3. Chain Rule</a>
  <a href="#viz-gradient">4. Gradient Landscape</a>
  <a href="#viz-lr">5. Learning Rate</a>
</nav>

<!-- ============================================================ -->
<!-- VIZ 1: TANGENT LINE EXPLORER -->
<!-- ============================================================ -->
<section id="viz-tangent" class="viz-section">
  <h2>1. Tangent Line Explorer</h2>
  <p class="intro">Drag the red point along the curve f(x) = x&sup3; &minus; 3x to see how the tangent line and its slope change in real time. The tangent line color encodes the slope: <strong style="color:#4a9eff">blue = negative</strong>, <strong style="color:#fff">white = zero</strong>, <strong style="color:#e94560">red = positive</strong>.</p>

  <div id='viz1-container'>
<style>
  #viz1-container { margin: 0; padding: 16px; background: #1a1a2e; color: #e0e0e0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 14px; border-radius: 10px; }
  #viz1-container .readout { font-family: 'SF Mono', 'Fira Code', monospace; font-size: 14px; color: #16c79a; background: #16213e; padding: 8px 12px; border-radius: 4px; margin-top: 8px; }
  #viz1-container svg { display: block; background: #16213e; border-radius: 8px; }
</style>
<svg id='viz1-canvas' width='680' height='380'></svg>
<div class='readout' id='viz1-readout'>Drag the red point along the curve</div>
<script>
(function() {
  var W = 680, H = 380, M = {top: 20, right: 30, bottom: 35, left: 45};
  var pw = W - M.left - M.right, ph = H - M.top - M.bottom;
  var svg = d3.select('#viz1-canvas');
  var g = svg.append('g').attr('transform', 'translate(' + M.left + ',' + M.top + ')');

  var xS = d3.scaleLinear().domain([-3, 3]).range([0, pw]);
  var yS = d3.scaleLinear().domain([-6, 6]).range([ph, 0]);

  // Grid
  xS.ticks(12).forEach(function(v) {
    g.append('line').attr('x1',xS(v)).attr('x2',xS(v)).attr('y1',0).attr('y2',ph).attr('stroke','#2a2a4a').attr('stroke-dasharray','2,4');
  });
  yS.ticks(10).forEach(function(v) {
    g.append('line').attr('x1',0).attr('x2',pw).attr('y1',yS(v)).attr('y2',yS(v)).attr('stroke','#2a2a4a').attr('stroke-dasharray','2,4');
  });

  // Axes
  var xAxis = g.append('g').attr('transform','translate(0,' + ph + ')').call(d3.axisBottom(xS).ticks(6));
  xAxis.selectAll('text').attr('fill','#888');
  xAxis.selectAll('line,path').attr('stroke','#555');
  var yAxis = g.append('g').call(d3.axisLeft(yS).ticks(6));
  yAxis.selectAll('text').attr('fill','#888');
  yAxis.selectAll('line,path').attr('stroke','#555');

  // f(x) = x^3 - 3x
  function f(x) { return x*x*x - 3*x; }
  function df(x) { return 3*x*x - 3; }

  // Draw curve
  var pts = [];
  for (var x = -3; x <= 3.01; x += 0.02) pts.push([x, f(x)]);
  var lineGen = d3.line().x(function(d){return xS(d[0]);}).y(function(d){return yS(d[1]);});
  g.append('path').datum(pts).attr('d', lineGen).attr('fill','none').attr('stroke','#16c79a').attr('stroke-width',2.5);

  // Tangent line
  var tangentLine = g.append('line').attr('stroke','#e94560').attr('stroke-width',2).attr('stroke-dasharray','6,3');

  // Draggable point
  var cx = 0;
  var point = g.append('circle').attr('r',8).attr('fill','#e94560').attr('stroke','#fff').attr('stroke-width',2).attr('cursor','grab').attr('cx',xS(cx)).attr('cy',yS(f(cx)));

  function update(x0) {
    var y0 = f(x0), slope = df(x0);
    point.attr('cx', xS(x0)).attr('cy', yS(y0));
    var dx = 1.5;
    tangentLine.attr('x1', xS(x0 - dx)).attr('y1', yS(y0 - slope * dx))
              .attr('x2', xS(x0 + dx)).attr('y2', yS(y0 + slope * dx));
    var cs = d3.scaleLinear().domain([-5, 0, 5]).range(['#4a9eff','#ffffff','#e94560']).clamp(true);
    tangentLine.attr('stroke', cs(slope));
    var extra = Math.abs(slope) < 0.15 ? ' &larr; <b>Critical point!</b>' : '';
    document.getElementById('viz1-readout').innerHTML = 'x = ' + x0.toFixed(2) + ' &nbsp; f(x) = ' + y0.toFixed(2) + ' &nbsp; slope = <b>' + slope.toFixed(2) + '</b>' + extra;
  }

  point.call(d3.drag().on('drag', function(event) {
    var x0 = Math.max(-3, Math.min(3, xS.invert(event.x)));
    cx = x0;
    update(x0);
  }));
  update(0);
})();
</script>
</div>

  <div class="try-this">
    <strong>Try This:</strong>
    <ol>
      <li>Drag the point to the peaks and valleys. What is the slope there?</li>
      <li>Find the two points where the slope is exactly zero (critical points at x = &plusmn;1).</li>
      <li>Notice how the tangent line color shifts from blue to red as you cross a critical point.</li>
      <li>Where is the curve steepest? What slope value do you see there?</li>
    </ol>
  </div>
  <div class="formal-def">
    <h3>The Mathematics</h3>
    <p>The <strong>derivative</strong> of f at point a is: <code>f'(a) = lim[h&rarr;0] (f(a+h) &minus; f(a)) / h</code></p>
    <p>Geometrically, this is the slope of the tangent line at (a, f(a)).</p>
    <p>Tangent line equation: <code>y = f(a) + f'(a)(x &minus; a)</code></p>
  </div>
</section>

<hr class="section-divider">

<!-- ============================================================ -->
<!-- VIZ 2: DERIVATIVE COMPARATOR -->
<!-- ============================================================ -->
<section id="viz-comparator" class="viz-section">
  <h2>2. Derivative Comparator</h2>
  <p class="intro">See f(x) and f'(x) side by side with a linked cursor. Hover over either panel to track the relationship. Use the dropdown to switch between sin(x), x&sup3;&minus;3x, and sigmoid.</p>

  <div id='viz2-container'>
<style>
  #viz2-container { margin: 0; padding: 16px; background: #1a1a2e; color: #e0e0e0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 14px; border-radius: 10px; }
  #viz2-container .readout { font-family: 'SF Mono', 'Fira Code', monospace; font-size: 14px; color: #16c79a; background: #16213e; padding: 8px 12px; border-radius: 4px; margin-top: 8px; }
  #viz2-container svg { display: inline-block; background: #16213e; border-radius: 8px; }
  #viz2-container select { background: #16213e; color: #16c79a; border: 1px solid #16c79a; padding: 4px 8px; border-radius: 4px; font-size: 14px; margin-bottom: 8px; }
  #viz2-container .panel-label { font-size: 12px; color: #888; text-align: center; margin-top: 4px; }
</style>
<div><select id='viz2-func'><option value='sin'>sin(x) / cos(x)</option><option value='cubic'>x^3-3x / 3x^2-3</option><option value='sigmoid'>sigmoid / sigmoid'</option></select></div>
<div style='display:flex;gap:10px;'>
  <div><svg id='viz2-left' width='335' height='300'></svg><div class='panel-label'>f(x)</div></div>
  <div><svg id='viz2-right' width='335' height='300'></svg><div class='panel-label'>f'(x)</div></div>
</div>
<div class='readout' id='viz2-readout'>Hover over either panel to see linked values</div>
<script>
(function() {
  var W = 335, H = 300, M = {top: 15, right: 20, bottom: 30, left: 40};
  var pw = W - M.left - M.right, ph = H - M.top - M.bottom;

  var funcs = {
    sin: { f: function(x){return Math.sin(x);}, df: function(x){return Math.cos(x);}, xd: [-6.28, 6.28], ydf: [-1.2,1.2], yddf: [-1.2,1.2], label: 'sin(x)', dlabel: 'cos(x)' },
    cubic: { f: function(x){return x*x*x - 3*x;}, df: function(x){return 3*x*x - 3;}, xd: [-3,3], ydf: [-6,6], yddf: [-5,25], label: 'x^3 - 3x', dlabel: '3x^2 - 3' },
    sigmoid: { f: function(x){ var e=Math.exp(-x); return 1/(1+e); }, df: function(x){ var e=Math.exp(-x); var s=1/(1+e); return s*(1-s); }, xd: [-6,6], ydf: [-0.1,1.1], yddf: [-0.05,0.3], label: 'sigmoid(x)', dlabel: "sigmoid'(x)" }
  };

  function drawPanel(svgId, xDomain, yDomain, fn, color) {
    var svg = d3.select(svgId);
    svg.selectAll('*').remove();
    var g = svg.append('g').attr('transform', 'translate(' + M.left + ',' + M.top + ')');
    var xS = d3.scaleLinear().domain(xDomain).range([0, pw]);
    var yS = d3.scaleLinear().domain(yDomain).range([ph, 0]);

    // Grid
    xS.ticks(6).forEach(function(v) { g.append('line').attr('x1',xS(v)).attr('x2',xS(v)).attr('y1',0).attr('y2',ph).attr('stroke','#2a2a4a').attr('stroke-dasharray','2,4'); });
    yS.ticks(6).forEach(function(v) { g.append('line').attr('x1',0).attr('x2',pw).attr('y1',yS(v)).attr('y2',yS(v)).attr('stroke','#2a2a4a').attr('stroke-dasharray','2,4'); });

    var xA = g.append('g').attr('transform','translate(0,' + ph + ')').call(d3.axisBottom(xS).ticks(5));
    xA.selectAll('text').attr('fill','#888'); xA.selectAll('line,path').attr('stroke','#555');
    var yA = g.append('g').call(d3.axisLeft(yS).ticks(5));
    yA.selectAll('text').attr('fill','#888'); yA.selectAll('line,path').attr('stroke','#555');

    var pts = [];
    var step = (xDomain[1] - xDomain[0]) / 300;
    for (var x = xDomain[0]; x <= xDomain[1]; x += step) pts.push([x, fn(x)]);
    var lineGen = d3.line().x(function(d){return xS(d[0]);}).y(function(d){return yS(d[1]);}).defined(function(d){return isFinite(d[1]) && d[1]>=yDomain[0]-1 && d[1]<=yDomain[1]+1;});
    g.append('path').datum(pts).attr('d', lineGen).attr('fill','none').attr('stroke', color).attr('stroke-width',2.5);

    // Cursor line and dot
    var cursorLine = g.append('line').attr('y1',0).attr('y2',ph).attr('stroke','#e94560').attr('stroke-width',1).attr('stroke-dasharray','4,3').style('opacity',0);
    var cursorDot = g.append('circle').attr('r',5).attr('fill','#e94560').attr('stroke','#fff').attr('stroke-width',1.5).style('opacity',0);

    return { g: g, xS: xS, yS: yS, fn: fn, cursorLine: cursorLine, cursorDot: cursorDot, svg: svg };
  }

  var leftP, rightP, currentFunc = 'sin';

  function build() {
    var c = funcs[currentFunc];
    leftP = drawPanel('#viz2-left', c.xd, c.ydf, c.f, '#16c79a');
    rightP = drawPanel('#viz2-right', c.xd, c.yddf, c.df, '#e94560');

    function showCursor(xVal) {
      [leftP, rightP].forEach(function(p) {
        var px = p.xS(xVal), py = p.yS(p.fn(xVal));
        p.cursorLine.attr('x1', px).attr('x2', px).style('opacity', 0.7);
        p.cursorDot.attr('cx', px).attr('cy', py).style('opacity', 1);
      });
      document.getElementById('viz2-readout').innerHTML = 'x = ' + xVal.toFixed(2) + ' &nbsp; f(x) = ' + c.f(xVal).toFixed(3) + " &nbsp; f'(x) = " + c.df(xVal).toFixed(3);
    }

    function hideCursor() {
      [leftP, rightP].forEach(function(p) {
        p.cursorLine.style('opacity', 0);
        p.cursorDot.style('opacity', 0);
      });
    }

    // Overlay rects for mouse capture
    [leftP, rightP].forEach(function(p) {
      p.g.append('rect').attr('width', pw).attr('height', ph).attr('fill','transparent').attr('cursor','crosshair')
        .on('mousemove', function(event) {
          var coords = d3.pointer(event);
          var xVal = p.xS.invert(coords[0]);
          showCursor(xVal);
        })
        .on('mouseleave', hideCursor);
    });
  }

  build();

  d3.select('#viz2-func').on('change', function() {
    currentFunc = this.value;
    build();
  });
})();
</script>
</div>

  <div class="try-this">
    <strong>Try This:</strong>
    <ol>
      <li>With <strong>sin(x)</strong> selected, hover to find where cos(x) = 0. What is sin(x) doing at that point?</li>
      <li>Switch to <strong>x&sup3; &minus; 3x</strong>. Find the two zeros of the derivative &mdash; these are the extrema of f(x).</li>
      <li>Switch to <strong>sigmoid</strong>. Where is the derivative largest? What does that tell you about the function?</li>
      <li>For any function: when f'(x) crosses zero going from positive to negative, what happens to f(x)?</li>
    </ol>
  </div>
  <div class="formal-def">
    <h3>The Mathematics</h3>
    <p><strong>Function-derivative relationship:</strong></p>
    <p>&bull; f'(x) &gt; 0 &rArr; f is increasing &nbsp;&nbsp; &bull; f'(x) &lt; 0 &rArr; f is decreasing &nbsp;&nbsp; &bull; f'(x) = 0 &rArr; potential extremum</p>
  </div>
</section>

<hr class="section-divider">

<!-- ============================================================ -->
<!-- VIZ 3: CHAIN RULE STEP-THROUGH -->
<!-- ============================================================ -->
<section id="viz-chain" class="viz-section">
  <h2>3. Chain Rule Step-Through</h2>
  <p class="intro">Watch how a value flows through composed functions. For y = (2x + 1)&sup3;, we decompose into an inner function u = 2x + 1 and outer function y = u&sup3;. The chain rule multiplies their derivatives: dy/dx = (dy/du) &middot; (du/dx).</p>

  <div id='viz3-container'>
<style>
  #viz3-container { margin: 0; padding: 16px; background: #1a1a2e; color: #e0e0e0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 14px; border-radius: 10px; }
  #viz3-container .chain-box { display: inline-block; background: #16213e; border: 2px solid #333; border-radius: 10px; padding: 16px 20px; margin: 8px; text-align: center; min-width: 140px; vertical-align: middle; }
  #viz3-container .chain-box .box-title { font-size: 11px; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
  #viz3-container .chain-box .box-formula { font-size: 16px; color: #16c79a; margin-bottom: 4px; }
  #viz3-container .chain-box .box-value { font-size: 22px; font-weight: bold; color: #fff; }
  #viz3-container .chain-box .box-deriv { font-size: 13px; color: #e94560; margin-top: 6px; }
  #viz3-container .chain-arrow { display: inline-block; font-size: 28px; color: #555; vertical-align: middle; margin: 0 2px; }
  #viz3-container .chain-result { background: #16213e; border-radius: 8px; padding: 14px 18px; margin-top: 14px; font-family: 'SF Mono', monospace; font-size: 15px; }
  #viz3-container .highlight { color: #e94560; font-weight: bold; }
  #viz3-container .slider-row { margin: 12px 0; }
  #viz3-container .slider-row input[type=range] { width: 300px; accent-color: #16c79a; vertical-align: middle; }
  #viz3-container .slider-row span { color: #16c79a; font-family: 'SF Mono', monospace; }
</style>
<div class='slider-row'>
  <b>x = </b><span id='viz3-xval'>1.00</span>
  <input type='range' id='viz3-slider' min='-2' max='2' step='0.01' value='1'>
</div>
<div id='viz3-boxes' style='text-align:center;margin-top:10px;'>
  <div class='chain-box' id='viz3-input'>
    <div class='box-title'>Input</div>
    <div class='box-formula'>x</div>
    <div class='box-value' id='viz3-b1'>1.00</div>
  </div>
  <div class='chain-arrow'>&rarr;</div>
  <div class='chain-box' id='viz3-inner' style='border-color:#16c79a;'>
    <div class='box-title'>Inner: g(x)</div>
    <div class='box-formula'>2x + 1</div>
    <div class='box-value' id='viz3-b2'>3.00</div>
    <div class='box-deriv'>du/dx = <span id='viz3-d1'>2</span></div>
  </div>
  <div class='chain-arrow'>&rarr;</div>
  <div class='chain-box' id='viz3-outer' style='border-color:#e94560;'>
    <div class='box-title'>Outer: f(u)</div>
    <div class='box-formula'>u&sup3;</div>
    <div class='box-value' id='viz3-b3'>27.00</div>
    <div class='box-deriv'>dy/du = <span id='viz3-d2'>27.00</span></div>
  </div>
</div>
<div class='chain-result' id='viz3-result'></div>
<script>
(function() {
  var slider = document.getElementById('viz3-slider');

  function update() {
    var x = parseFloat(slider.value);
    var u = 2 * x + 1;
    var y = u * u * u;
    var du_dx = 2;
    var dy_du = 3 * u * u;
    var dy_dx = dy_du * du_dx;

    document.getElementById('viz3-xval').textContent = x.toFixed(2);
    document.getElementById('viz3-b1').textContent = x.toFixed(2);
    document.getElementById('viz3-b2').textContent = u.toFixed(2);
    document.getElementById('viz3-b3').textContent = y.toFixed(2);
    document.getElementById('viz3-d1').textContent = du_dx.toFixed(0);
    document.getElementById('viz3-d2').textContent = dy_du.toFixed(2);
    document.getElementById('viz3-result').innerHTML =
      '<span style="color:#888">Chain Rule:</span> ' +
      'dy/dx = dy/du &times; du/dx = ' +
      '<span class="highlight">' + dy_du.toFixed(2) + '</span>' +
      ' &times; ' +
      '<span class="highlight">' + du_dx + '</span>' +
      ' = <span style="color:#fff;font-size:18px;font-weight:bold;">' + dy_dx.toFixed(2) + '</span>';
  }

  slider.addEventListener('input', update);
  update();
})();
</script>
</div>

  <div class="try-this">
    <strong>Try This:</strong>
    <ol>
      <li>Set x = 0. What is u? What is dy/dx?</li>
      <li>Set x = &minus;0.5 so that u = 0. What happens to the derivative? Why?</li>
      <li>Compare x = 1 and x = &minus;1. The outer derivative changes dramatically &mdash; why?</li>
      <li>Verify: at any x, the product of the two local derivatives equals the total derivative.</li>
    </ol>
  </div>
  <div class="formal-def">
    <h3>The Mathematics</h3>
    <p><strong>The Chain Rule:</strong> If y = f(g(x)), then <code>dy/dx = f'(g(x)) &middot; g'(x)</code></p>
    <p>The rates of change <em>multiply</em> through the chain. This is the mathematical heart of backpropagation.</p>
  </div>
</section>

<hr class="section-divider">

<!-- ============================================================ -->
<!-- VIZ 4: GRADIENT LANDSCAPE -->
<!-- ============================================================ -->
<section id="viz-gradient" class="viz-section">
  <h2>4. Gradient Landscape</h2>
  <p class="intro">Drag the point on the contour map of f(x,y) = x&sup2; + 2y&sup2; to see the gradient arrow. The gradient &nabla;f = (2x, 4y) always points in the direction of steepest ascent. The red arrow shows the negative gradient (steepest descent direction).</p>

  <div id='viz4-container'>
<style>
  #viz4-container { margin: 0; padding: 16px; background: #1a1a2e; color: #e0e0e0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 14px; border-radius: 10px; }
  #viz4-container .readout { font-family: 'SF Mono', 'Fira Code', monospace; font-size: 14px; color: #16c79a; background: #16213e; padding: 8px 12px; border-radius: 4px; margin-top: 8px; }
  #viz4-container canvas { display: block; border-radius: 8px; }
  #viz4-container svg { position: absolute; top: 0; left: 0; border-radius: 8px; }
</style>
<div style='position:relative;width:500px;height:500px;'>
  <canvas id='viz4-heatmap' width='500' height='500'></canvas>
  <svg id='viz4-overlay' width='500' height='500' style='position:absolute;top:0;left:0;'></svg>
</div>
<div class='readout' id='viz4-readout'>Drag the point to explore the gradient</div>
<script>
(function() {
  var S = 500, pad = 50;
  var xDomain = [-4, 4], yDomain = [-4, 4];

  // f(x,y) = x^2 + 2y^2
  function f(x, y) { return x*x + 2*y*y; }

  // Draw heatmap on canvas
  var canvas = document.getElementById('viz4-heatmap');
  var ctx = canvas.getContext('2d');
  var imgData = ctx.createImageData(S, S);

  var maxVal = 32;
  for (var py = 0; py < S; py++) {
    for (var px = 0; px < S; px++) {
      var x = xDomain[0] + (xDomain[1] - xDomain[0]) * px / S;
      var y = yDomain[0] + (yDomain[1] - yDomain[0]) * py / S;
      var val = f(x, y);
      var t = Math.min(val / maxVal, 1);
      // Color: dark blue to teal to yellow
      var r, g, b;
      if (t < 0.5) {
        var s = t / 0.5;
        r = Math.floor(22 + s * 0); g = Math.floor(30 + s * 170); b = Math.floor(80 + s * 50);
      } else {
        var s = (t - 0.5) / 0.5;
        r = Math.floor(22 + s * 233); g = Math.floor(200 - s * 30); b = Math.floor(130 - s * 100);
      }
      var idx = (py * S + px) * 4;
      imgData.data[idx] = r; imgData.data[idx+1] = g; imgData.data[idx+2] = b; imgData.data[idx+3] = 255;
    }
  }
  ctx.putImageData(imgData, 0, 0);

  // Draw contour lines on canvas
  var levels = [1, 2, 4, 8, 12, 16, 24, 32];
  ctx.strokeStyle = 'rgba(255,255,255,0.2)';
  ctx.lineWidth = 1;
  levels.forEach(function(lev) {
    // Ellipse: x^2 + 2y^2 = lev => x = sqrt(lev)*cos(t), y = sqrt(lev/2)*sin(t)
    if (lev > 0) {
      ctx.beginPath();
      for (var t = 0; t <= 2*Math.PI + 0.05; t += 0.05) {
        var ex = Math.sqrt(lev) * Math.cos(t);
        var ey = Math.sqrt(lev / 2) * Math.sin(t);
        var spx = (ex - xDomain[0]) / (xDomain[1] - xDomain[0]) * S;
        var spy = (ey - yDomain[0]) / (yDomain[1] - yDomain[0]) * S;
        if (t === 0) ctx.moveTo(spx, spy); else ctx.lineTo(spx, spy);
      }
      ctx.stroke();
    }
  });

  // SVG overlay for interactive elements
  var svg = d3.select('#viz4-overlay');
  var xS = d3.scaleLinear().domain(xDomain).range([0, S]);
  var yS = d3.scaleLinear().domain(yDomain).range([0, S]);

  // Arrow marker
  svg.append('defs').append('marker').attr('id','viz4-arrowhead').attr('viewBox','0 0 10 10')
    .attr('refX',8).attr('refY',5).attr('markerWidth',6).attr('markerHeight',6).attr('orient','auto')
    .append('path').attr('d','M 0 0 L 10 5 L 0 10 z').attr('fill','#e94560');

  var arrow = svg.append('line').attr('stroke','#e94560').attr('stroke-width',3).attr('marker-end','url(#viz4-arrowhead)');
  var point = svg.append('circle').attr('r',8).attr('fill','#fff').attr('stroke','#e94560').attr('stroke-width',2.5).attr('cursor','grab');

  var cx = 2.5, cy = 1.5;

  function update(px, py) {
    point.attr('cx', xS(px)).attr('cy', yS(py));
    // Gradient: (2x, 4y), negative for descent
    var gx = -2 * px, gy = -4 * py;
    // Scale arrow for visibility
    var mag = Math.sqrt(gx*gx + gy*gy);
    var scale = Math.min(1.5, 60 / (mag + 0.01));
    var ax = gx * scale, ay = gy * scale;
    arrow.attr('x1', xS(px)).attr('y1', yS(py))
         .attr('x2', xS(px + ax)).attr('y2', yS(py + ay));
    var fval = f(px, py);
    document.getElementById('viz4-readout').innerHTML =
      'Position: (' + px.toFixed(2) + ', ' + py.toFixed(2) + ')' +
      ' &nbsp; f = ' + fval.toFixed(2) +
      ' &nbsp; &nabla;f = (' + (2*px).toFixed(2) + ', ' + (4*py).toFixed(2) + ')' +
      ' &nbsp; |&nabla;f| = ' + Math.sqrt(4*px*px + 16*py*py).toFixed(2);
  }

  point.call(d3.drag().on('drag', function(event) {
    cx = Math.max(-3.8, Math.min(3.8, xS.invert(event.x)));
    cy = Math.max(-3.8, Math.min(3.8, yS.invert(event.y)));
    update(cx, cy);
  }));
  update(cx, cy);
})();
</script>
</div>

  <div class="try-this">
    <strong>Try This:</strong>
    <ol>
      <li>Drag to the origin. What happens to the gradient arrow? Why?</li>
      <li>Move along the x-axis vs the y-axis. Which direction has a steeper gradient? (Hint: the 2y&sup2; term.)</li>
      <li>Notice the arrow is always perpendicular to the contour ellipses.</li>
      <li>As you move further from the origin, does the gradient get stronger or weaker?</li>
    </ol>
  </div>
  <div class="formal-def">
    <h3>The Mathematics</h3>
    <p><strong>The Gradient:</strong> <code>&nabla;f = (&part;f/&part;x, &part;f/&part;y)</code></p>
    <p>The gradient points in the direction of steepest increase. Its magnitude tells you how steep.</p>
    <p>Gradient descent updates: <code>&theta;<sub>new</sub> = &theta;<sub>old</sub> &minus; &alpha; &nabla;f(&theta;)</code></p>
  </div>
</section>

<hr class="section-divider">

<!-- ============================================================ -->
<!-- VIZ 5: LEARNING RATE EFFECT -->
<!-- ============================================================ -->
<section id="viz-lr" class="viz-section">
  <h2>5. Learning Rate Effect</h2>
  <p class="intro">Gradient descent on f(x) = x&sup2; starting from x = 4. Adjust the learning rate &alpha; with the slider and watch: too small means painfully slow convergence, just right means fast convergence, too large means divergence.</p>

  <div id='viz5-container'>
<style>
  #viz5-container { margin: 0; padding: 16px; background: #1a1a2e; color: #e0e0e0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 14px; border-radius: 10px; }
  #viz5-container .readout { font-family: 'SF Mono', 'Fira Code', monospace; font-size: 14px; color: #16c79a; background: #16213e; padding: 8px 12px; border-radius: 4px; margin-top: 8px; }
  #viz5-container svg { display: block; background: #16213e; border-radius: 8px; }
  #viz5-container .slider-row { margin: 12px 0; }
  #viz5-container .slider-row input[type=range] { width: 350px; accent-color: #16c79a; vertical-align: middle; }
  #viz5-container .slider-row span { color: #16c79a; font-family: 'SF Mono', monospace; font-weight: bold; }
  #viz5-container .status { display: inline-block; padding: 2px 8px; border-radius: 3px; font-size: 12px; font-weight: bold; margin-left: 10px; }
</style>
<div class='slider-row'>
  <b>Learning rate &alpha; = </b><span id='viz5-lr-val'>0.30</span>
  <input type='range' id='viz5-lr' min='0.01' max='1.2' step='0.01' value='0.30'>
  <span class='status' id='viz5-status' style='background:#16c79a;color:#000;'>Converges</span>
</div>
<svg id='viz5-canvas' width='680' height='350'></svg>
<div class='readout' id='viz5-readout'>Adjust the learning rate slider</div>
<script>
(function() {
  var W = 680, H = 350, M = {top: 20, right: 30, bottom: 35, left: 45};
  var pw = W - M.left - M.right, ph = H - M.top - M.bottom;
  var svg = d3.select('#viz5-canvas');
  var g = svg.append('g').attr('transform', 'translate(' + M.left + ',' + M.top + ')');

  var xS = d3.scaleLinear().domain([-5, 5]).range([0, pw]);
  var yS = d3.scaleLinear().domain([-1, 25]).range([ph, 0]);

  // Grid
  xS.ticks(10).forEach(function(v) { g.append('line').attr('x1',xS(v)).attr('x2',xS(v)).attr('y1',0).attr('y2',ph).attr('stroke','#2a2a4a').attr('stroke-dasharray','2,4'); });
  yS.ticks(8).forEach(function(v) { g.append('line').attr('x1',0).attr('x2',pw).attr('y1',yS(v)).attr('y2',yS(v)).attr('stroke','#2a2a4a').attr('stroke-dasharray','2,4'); });

  var xA = g.append('g').attr('transform','translate(0,' + ph + ')').call(d3.axisBottom(xS).ticks(10));
  xA.selectAll('text').attr('fill','#888'); xA.selectAll('line,path').attr('stroke','#555');
  var yA = g.append('g').call(d3.axisLeft(yS).ticks(6));
  yA.selectAll('text').attr('fill','#888'); yA.selectAll('line,path').attr('stroke','#555');

  // f(x) = x^2
  var pts = [];
  for (var x = -5; x <= 5.01; x += 0.05) pts.push([x, x*x]);
  var lineGen = d3.line().x(function(d){return xS(d[0]);}).y(function(d){return yS(d[1]);}).defined(function(d){return d[1]<=25;});
  g.append('path').datum(pts).attr('d', lineGen).attr('fill','none').attr('stroke','#16c79a').attr('stroke-width',2.5);

  // GD elements group
  var gdGroup = g.append('g');

  function runGD(lr) {
    gdGroup.selectAll('*').remove();
    var x0 = 4.0;
    var steps = [x0];
    var maxSteps = 30;
    var converged = false, diverged = false;

    for (var i = 0; i < maxSteps; i++) {
      var grad = 2 * x0;
      var x1 = x0 - lr * grad;
      steps.push(x1);
      if (Math.abs(x1) < 0.01) { converged = true; break; }
      if (Math.abs(x1) > 10) { diverged = true; break; }
      x0 = x1;
    }

    // Draw descent path (lines along the curve)
    for (var i = 0; i < steps.length - 1; i++) {
      var sx = steps[i], sy = sx * sx;
      var nx = steps[i+1], ny = nx * nx;
      // Vertical drop to x-axis then horizontal move
      gdGroup.append('line')
        .attr('x1', xS(sx)).attr('y1', yS(Math.min(sy, 25)))
        .attr('x2', xS(nx)).attr('y2', yS(Math.min(sy, 25)))
        .attr('stroke', '#e94560').attr('stroke-width', 1.5).attr('stroke-dasharray', '4,3').attr('opacity', 0.6);
      gdGroup.append('line')
        .attr('x1', xS(nx)).attr('y1', yS(Math.min(sy, 25)))
        .attr('x2', xS(nx)).attr('y2', yS(Math.min(ny, 25)))
        .attr('stroke', '#e94560').attr('stroke-width', 1.5).attr('stroke-dasharray', '4,3').attr('opacity', 0.6);
    }

    // Draw dots at each step
    steps.forEach(function(sx, i) {
      var sy = sx * sx;
      if (sy <= 25) {
        var alpha = Math.max(0.3, 1 - i * 0.05);
        gdGroup.append('circle')
          .attr('cx', xS(sx)).attr('cy', yS(sy))
          .attr('r', i === 0 ? 6 : 4)
          .attr('fill', i === 0 ? '#fff' : '#e94560')
          .attr('stroke', i === 0 ? '#e94560' : 'none')
          .attr('stroke-width', 2)
          .attr('opacity', alpha);
      }
    });

    // Step number labels for first few
    var labelsToShow = Math.min(5, steps.length);
    for (var i = 0; i < labelsToShow; i++) {
      var sx = steps[i], sy = sx * sx;
      if (sy <= 25) {
        gdGroup.append('text').attr('x', xS(sx)).attr('y', yS(sy) - 10)
          .attr('text-anchor', 'middle').attr('fill', '#888').attr('font-size', 10)
          .text('t=' + i);
      }
    }

    // Update status
    var statusEl = document.getElementById('viz5-status');
    if (diverged) {
      statusEl.textContent = 'Diverges!';
      statusEl.style.background = '#e94560';
      statusEl.style.color = '#fff';
    } else if (converged) {
      statusEl.textContent = 'Converges in ' + (steps.length - 1) + ' steps';
      statusEl.style.background = '#16c79a';
      statusEl.style.color = '#000';
    } else {
      statusEl.textContent = 'Slow convergence';
      statusEl.style.background = '#f5a623';
      statusEl.style.color = '#000';
    }

    var lastX = steps[steps.length - 1];
    document.getElementById('viz5-readout').innerHTML =
      '&alpha; = ' + lr.toFixed(2) +
      ' &nbsp; Start: x=4.00' +
      ' &nbsp; After ' + (steps.length-1) + ' steps: x = ' + lastX.toFixed(4) +
      ' &nbsp; f(x) = ' + (lastX*lastX).toFixed(4);
  }

  var slider = document.getElementById('viz5-lr');
  slider.addEventListener('input', function() {
    var lr = parseFloat(slider.value);
    document.getElementById('viz5-lr-val').textContent = lr.toFixed(2);
    runGD(lr);
  });
  runGD(0.3);
})();
</script>
</div>

  <div class="try-this">
    <strong>Try This:</strong>
    <ol>
      <li>Set &alpha; = 0.05. How many steps to converge? Now try &alpha; = 0.3.</li>
      <li>Slowly increase &alpha; past 0.9. What happens to the path?</li>
      <li>At exactly &alpha; = 1.0, the updates bounce between +4 and &minus;4 forever. Why?</li>
      <li>Find the largest learning rate that still converges. (For f(x) = x&sup2;, the theory says &alpha; &lt; 1.)</li>
    </ol>
  </div>
  <div class="formal-def">
    <h3>The Mathematics</h3>
    <p><strong>Gradient Descent:</strong> <code>x<sub>t+1</sub> = x<sub>t</sub> &minus; &alpha; f'(x<sub>t</sub>)</code></p>
    <p>For f(x) = x&sup2;: f'(x) = 2x, so the update is x<sub>t+1</sub> = x<sub>t</sub>(1 &minus; 2&alpha;).</p>
    <p>Convergence requires |1 &minus; 2&alpha;| &lt; 1, i.e., 0 &lt; &alpha; &lt; 1. Optimal: &alpha; = 0.5 (converges in one step).</p>
  </div>
</section>

<!-- ============================================================ -->
<!-- CONCEPT SUMMARY -->
<!-- ============================================================ -->
<section class="summary-section">
  <h2>Concept Summary</h2>
  <table>
    <thead>
      <tr>
        <th>Visualization</th>
        <th>Concept</th>
        <th>Key Interaction</th>
        <th>Key Insight</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Tangent Line Explorer</td>
        <td>Derivative</td>
        <td>Drag point along curve</td>
        <td>Derivative = slope of tangent; zero at peaks/valleys</td>
      </tr>
      <tr>
        <td>Derivative Comparator</td>
        <td>f(x) vs f'(x)</td>
        <td>Linked cursor hover</td>
        <td>Zeros of f'(x) = extrema of f(x)</td>
      </tr>
      <tr>
        <td>Chain Rule Step-Through</td>
        <td>Chain Rule</td>
        <td>Slider for input x</td>
        <td>Derivatives multiply through the chain</td>
      </tr>
      <tr>
        <td>Gradient Landscape</td>
        <td>2D Gradient</td>
        <td>Drag point on surface</td>
        <td>Gradient points uphill; descent follows negative gradient</td>
      </tr>
      <tr>
        <td>Learning Rate Effect</td>
        <td>Gradient Descent</td>
        <td>Learning rate slider</td>
        <td>Too small = slow, too large = diverge, just right = converge</td>
      </tr>
    </tbody>
  </table>
</section>

</body>
</html>